var draw=function(){var e=document.querySelector("main"),t=e.offsetWidth,n=e.offsetHeight,o=document.createElement("canvas"),i=o.getContext("2d"),r=o.getBoundingClientRect(),a=0,l=0,d=0,s=0,c=0,u=0,g=!1,h=!1,f="",w=!1,m="",k="",C=[],S=0;return{setIsDrawing:function(e){w=e},getIsDrawing:function(){return w},getShape:function(){return f},setShape:function(e){f=e},randColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},setStrokeColor:function(e){m=e},setFillColor:function(e){k=e},getStrokeColor:function(){return 6<m.length?m:this.randColor()},getFillColor:function(){return 6<k.length?k:this.randColor()},setStart:function(){d=a,s=l},setEnd:function(){c=a,u=l},setPoint:function(){C[S]=[],C[S].x=a,C[S].y=l,2<C.length?(this.draw(),S=0,C=[]):S++},setXY:function(e){g=a,h=l,a=e.clientX-r.left-o.offsetLeft,l=e.clientY-r.top-o.offsetTop},writeXY:function(){document.getElementById("trackX").innerHTML="X: "+a,document.getElementById("trackY").innerHTML="Y: "+l},draw:function(){switch(i.restore(),f){case"rectangle":this.drawRect();break;case"line":this.drawLine();break;case"circle":this.drawCircle();break;case"path":this.drawPath();break;case"3-point":this.draw3Point();break;case"triangle":this.drawTriangle();break;default:alert("Please choose a shape")}i.save()},draw3Point:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(C[0].x,C[0].y),i.lineTo(C[1].x,C[1].y),i.lineTo(C[2].x,C[2].y),i.lineTo(C[0].x,C[0].y),i.stroke(),i.fill()},drawPath:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(g,h),i.lineTo(a,l),i.stroke()},drawCircle:function(){i.strokeStyle=this.getStrokeColor(),i.fillStyle=this.getFillColor();var e=d-c,t=s-u,n=Math.sqrt(e*e+t*t);i.beginPath(),i.arc(d,s,n,0,2*Math.PI),i.stroke(),i.fill()},drawLine:function(){i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(d,s),i.lineTo(c,u),i.stroke()},drawTriangle:function(){var e=d-c,t=s-u,n=Math.sqrt(e*e+t*t),o=d+n,r=s+n;c<d&&(o=d-n),u<s&&(r=s-n),i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.beginPath(),i.moveTo(d,s),i.lineTo(o,r),i.lineTo(c,u),i.lineTo(d,s),i.stroke(),i.fill()},drawRect:function(){i.fillStyle=this.getFillColor(),i.strokeStyle=this.getStrokeColor(),i.fillRect(d,s,c-d,u-s)},getCanvas:function(){return o},init:function(){o.width=t,o.height=n,e.appendChild(o)}}}();draw.init(),document.getElementById("btnRect").addEventListener("click",function(){draw.setShape("rectangle")}),document.getElementById("btnCircle").addEventListener("click",function(){draw.setShape("circle")}),document.getElementById("btnPath").addEventListener("click",function(){draw.setShape("path")}),document.getElementById("btnTriangle").addEventListener("click",function(){draw.setShape("triangle")}),document.getElementById("btnLine").addEventListener("click",function(){draw.setShape("line")}),document.getElementById("btn3Point").addEventListener("click",function(){draw.setShape("3-point")}),draw.getCanvas().addEventListener("mousedown",function(){"3-point"!==draw.getShape()&&(draw.setStart(),draw.setIsDrawing(!0))}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"!==draw.getShape()&&(draw.setEnd(),draw.draw(),draw.setIsDrawing(!1)),"3-point"===draw.getShape()&&draw.setPoint()}),draw.getCanvas().addEventListener("mousemove",function(e){draw.setXY(e),draw.writeXY(),"path"===draw.getShape()&&!0===draw.getIsDrawing()&&draw.draw()}),document.getElementById("strokeColor").addEventListener("change",function(){draw.setStrokeColor(document.getElementById("strokeColor").value)}),document.getElementById("randStrokeColor").addEventListener("change",function(){draw.setStrokeColor("")}),document.getElementById("fillColor").addEventListener("change",function(){draw.setFillColor(document.getElementById("fillColor").value)}),document.getElementById("randFillColor").addEventListener("change",function(){draw.setFillColor("")});